---
layout: post
title: How to Use BLS API
---

<h3>The Traditional Route</h3>

The US Bureau of Labor Statistics provides a vast repository of labor market information for the United States and its territories, most of it down to the county or city level. However, gaining access to the specific data you want requires clicking through various sites and using the BLS database query tools. If you can do some basic programming, there's a more direct route. BLS provides public and private APIs (application programming interfaces) that allow programmers to retrieve any published data in JSON format. In order to get started, you'll want to register a [public API data account](https://data.bls.gov/registrationEngine/). Registering allows you to access version 2.0 of the API, which provides access to additional data more frequently (up to 500 queries a day). There is additional functionality such as the ability to add calculations and annual averages to requests, along with series descriptions. 

Just as a quick introduction to BLS data, there are [data](https://www.bls.gov/data/) for inflation & prices (cost of living, etc.), employment (and employment projections), unemployment, pay and benefits, spending and time use, productivity, workplace injuries, occupational requirements, regional resources, international import/export price indexes, along with a large amount of historical data. Finding the specific table - referred to by their series ID - which can be tricky. Series IDs follow a consistent format, but you need to know the series ID for the data you want in order to request data using the BLS Public Data API. Unfortunately, there is no central repository of series IDs, but all BLS series IDs follow a similar [format](https://www.bls.gov/help/hlpforma.htm). For example, the series ID for national employment, hours and earnings is CEU0800000003. 

It's hard to know where to start with APIs, even if you know which series you're interested in. Fortunately for newbies like myself, BLS provides [sample code](https://www.bls.gov/developers/api_sample_code.htm) for making API requests in C#, Java, PHP, Python, R, Ruby/Ruby on Rails, SAS, Unix Command Line, Matlab and Julia. Since I'm interested in Python, I've selected the Python sample code as a template for my API request:

```
import requests
import json
import prettytable
headers = {'Content-type': 'application/json'}
data = json.dumps({"seriesid": ['CUUR0000SA0','SUUR0000SA0'],"startyear":"2011", "endyear":"2014"})
p = requests.post('https://api.bls.gov/publicAPI/v2/timeseries/data/', data=data, headers=headers)
json_data = json.loads(p.text)
for series in json_data['Results']['series']:
    x=prettytable.PrettyTable(["series id","year","period","value","footnotes"])
    seriesId = series['seriesID']
    for item in series['data']:
        year = item['year']
        period = item['period']
        value = item['value']
        footnotes=""
        for footnote in item['footnotes']:
            if footnote:
                footnotes = footnotes + footnote['text'] + ','
        if 'M01' <= period <= 'M12':
            x.add_row([seriesId,year,period,value,footnotes[0:-1]])
    output = open(seriesId + '.txt','w')
    output.write (x.get_string())
    output.close()
```

The sample code provided by BLS will retrieve data from the Inflation & Prices average price (CUUR0000SA0) and chained CPI (SUUR0000SA0) data series for the years 2011 through 2014. This code writes the data to text files, named according to the series they're derived from. You can simply replace the values for series ID and years in the sample code if you like, but you'll eventually find that limits your options a bit. 

It's better to locate the series you're interested in and import it into Pandas. In order to find the series name and fields, refer to the [Series ID Formats](https://www.bls.gov/help/hlpforma.htm#AP) page. Once you know the series ID for the data you would like to request, you can simply append the ID to the version one API URL, [https://api.bls.gov/publicAPI/v1/timeseries/data/](https://api.bls.gov/publicAPI/v1/timeseries/data/), and use the requests Python package to return the data in dictionary or list format:

```
import requests
url = 'https://api.bls.gov/publicAPI/v1/timeseries/data/CUUR0000SA0' # using the Inflation & Prices average price series
data = requests.get(url).json()
print('Status: ' + data['status'])

```

Once the data has been successfully retrieved, you can create a Pandas dataframe with it. But first you'll need to know what the data looks like or what the keys are. Printing out the keys `print(data.keys())` will provide you with an array listing out the keys, which should look something like this: `[u'status', u'message', u'Results', u'responseTime']`. The results key contains a series list, with __Results[0]__ containing the relevant data in the form of dictionaries. If you print __Results[0]__, you will see something like this: `{u'footnotes': [{}], u'periodName': u'July', u'period': u'M07', u'value': u'62.9', u'year': u'2017'}`.


```
import pandas as pd

dates = ['{} {}'.format(i['period'], i['year']) for i in r]
index = pd.to_datetime(dates)
data = {series['id']: [float(i['value']) for i in r],
        'footnotes': [i['footnotes'][0] for i in r]}

df = pd.DataFrame(index=index, data=data).iloc[::-1]
```

<h3>Using the Python BLS Library</h3>

There is a new [Python library](https://pypi.python.org/pypi/bls) for the Bureau of Labor Statistics API, and although it's still being developed, it looks promising. 
